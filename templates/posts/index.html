{% extends 'base.html' %} 
{% load static cache humanize main_tags posts_tags %}

{% block advertisement %}
    {% include '_advertisement.html' %}
{% endblock %}

{% block content %}

<div class="row bg-white">
    <div class="post-content col-md-9 mt-1">
        <!-- Search results -->
        {% if request.GET.q %}
            <div class=" bg-white p-4 mb-4 mx-2 mt-5 rounded custom-shadow">
                {% if posts %}
                    <h2 class="mt-4">Результати пошуку <b>{{ request.GET.q }}</b></h2>
                {% else %}
                    <h2 class="mt-4">За запитом <b>{{ request.GET.q }}</b> нічого не знайдено</h2>
                    {% block css %}
                        <link rel="stylesheet" href="{% static 'css/fix_footer.css' %}" />
                    {% endblock %}
                {% endif %}
            </div>
        {% endif %}
    </div>

    <!-- Posts list -->
    <div class="post-content col-md-9 mt-2">
        {% include 'posts/_posts_list.html' %}
    </div>

    <!-- Topics -->
    {% if not request.GET.q %}
        <div class="latest_posts col-md-3 mt-4 text-center">
            <h4>Рубрики</h4>
            {% for topic in topics %}
                {% if type %}
                    <a href="{% url 'posts:type' slug_url %}?topic={{ topic.slug }}" 
                        class="topic-button btn btn-dark d-block mb-2">
                        {{ topic.name }}
                    </a>
                {% endif %}
            {% endfor %}
        </div>
    {% endif %}
</div>

<!-- Pagination -->
{% if posts.paginator.num_pages > 1 %}
    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center my-4">
            <div class="custom-shadow d-flex">
                <li class="page-item {% if not posts.has_previous %} disabled {% endif %}">
                    <a class="page-link {% if posts.has_previous %} bg-dark text-white {% endif %}"
                        href="{% if posts.has_previous %}?{% change_params page=posts.previous_page_number %}{% else %}#{% endif %}">
                        Назад
                    </a>
                </li>

                {% for page in posts.paginator.page_range %}
                    {% if user_agent.is_mobile %}
                        {% if page >= posts.number|add:-2 and page <= posts.number|add:2 %}

                            <li class="page-item {% if posts.number == page %} active {% endif %}">
                                <a class="page-link {% if posts.number == page %} bg-dark text-white {% else %} bg-light text-dark {% endif %}" 
                                    href="?{% change_params page=page %}">{{ page }}</a>
                            </li>

                        {% endif %}
                    {% else %}
                        {% if page >= posts.number|add:-5 and page <= posts.number|add:5 %}
                            
                            <li class="page-item {% if posts.number == page %} active {% endif %}">
                                <a class="page-link {% if posts.number == page %} bg-dark text-white {% else %} bg-light text-dark {% endif %}" 
                                    href="?{% change_params page=page %}">{{ page }}</a>
                            </li>

                        {% endif %}
                    {% endif %}
                {% endfor %}

                <li class="page-item {% if not posts.has_next %} disabled {% endif %}">
                    <a class="page-link {% if posts.has_next %} bg-dark text-white {% endif %}"
                        href="{% if posts.has_next %}?{% change_params page=posts.next_page_number %}{% else %}#{% endif %}">
                        Вперед
                    </a>
                </li>
            </div>
        </ul>
    </nav>
{% endif %}

{% endblock %}

<!-- Filters -->
<!-- <div class="dropdown mb-2">
    <button class="btn btn-secondary dropdown-toggle btn-dark" type="button" data-bs-toggle="dropdown"
        aria-expanded="false">Фільтри</button>

    <form action="{% if request.GET.q %}{% url 'posts:search' %}{% else %}{% url 'posts:type' slug_url %}{% endif %}"
        method="GET" class="dropdown-menu bg-dark" data-bs-theme="dark">

        <div class="form-check text-white mx-3">
            <input class="form-check-input" type="checkbox" name="on_sale" id="flexCheckDefault" value="on" 
            {% if request.GET.on_sale %} checked {% endif %} />
            {% if request.GET.q %}<input type="hidden" name="q" value="{{ request.GET.q }}" />{% endif %}
            <label class="form-check-label" for="flexCheckDefault">
                Товари по акції
            </label>
        </div>

        <p class="text-white mx-3 mt-3">Сортувати:</p>
        <div class="form-check text-white mx-3">
            <input class="form-check-input" type="radio" name="order_by" id="flexRadioDefault1" value="default" 
            {% if not request.GET.order_by or request.GET.order_by == 'default' %} checked {% endif %} />

            <label class="form-check-label" for="flexRadioDefault1">
                За замовчуванням
            </label>
        </div>
        <div class="form-check text-white mx-3">
            <input class="form-check-input" type="radio" name="order_by" id="flexRadioDefault2" value="price" 
            {% if request.GET.order_by == 'price' %} checked {% endif %} />

            <label class="form-check-label" for="flexRadioDefault2">
                Від дешевих до дорогих
            </label>
        </div>
        <div class="form-check text-white mx-3">
            <input class="form-check-input" type="radio" name="order_by" id="flexRadioDefault3" value="-price" 
            {% if request.GET.order_by == '-price' %} checked {% endif %} />

            <label class="form-check-label" for="flexRadioDefault3">
                Від дорогих до дешевих
            </label>
        </div>
        <button type="submit" class="btn btn-primary mx-3 mt-3">Застосувати</button>
    </form>
</div> -->
